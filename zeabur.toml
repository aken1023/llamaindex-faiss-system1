[build]
  # 不需要全局建構命令
  # buildCommand = "npm run build"

[services]
  [services.web]
    type = "nextjs"
    buildCommand = "npm run build"
    startCommand = "npm run start"
    port = 3000

  [services.api]
    type = "python"
    buildCommand = "pip install -r scripts/requirements.txt && pip install PyJWT"
    # 使用專門為Zeabur環境優化的啟動腳本
    startCommand = "python scripts/zeabur_start.py"
    # Zeabur會自動分配PORT環境變量
    port = 8000
    [services.api.env]
      DEEPSEEK_API_KEY = "$DEEPSEEK_API_KEY"
      EMBEDDING_MODEL = "BAAI/bge-base-zh"
      MODEL_NAME = "deepseek-chat"
      # 設置為單用戶模式(如果需要多用戶模式，改為true)
      USE_MULTI_USER = "false"

[persistentVolumes]
  [persistentVolumes.storage]
    mountPath = "/app/documents"
    size = "1Gi"

  [persistentVolumes.faiss]
    mountPath = "/app/faiss_index"
    size = "1Gi"

  [persistentVolumes.logs]
    mountPath = "/app/logs"
    size = "500Mi"

[env]
  NODE_ENV = "production"
  # 明確設定API URL
  NEXT_PUBLIC_API_URL = "https://ragaken.zeabur.app" 