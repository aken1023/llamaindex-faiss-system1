# Zeabur é…ç½®æ–‡ä»¶ - Python åŸç”Ÿéƒ¨ç½²
# ä¼æ¥­çŸ¥è­˜åº«ç³»çµ±ï¼ˆLlamaIndex + FAISS + ç”¨æˆ¶èªè­‰ï¼‰

[build]
# æŒ‡å®šæ§‹å»ºé¡å‹ç‚º Python
type = "python"

# æŒ‡å®š Python ç‰ˆæœ¬
python_version = "3.11"

# æŒ‡å®šä¾è³´æ–‡ä»¶ï¼ˆæœƒä¾åºå˜—è©¦ï¼‰
requirements = [
    "scripts/requirements-api-only.txt", # å„ªå…ˆä½¿ç”¨ç´” API ç‰ˆæœ¬ï¼ˆæœ€ç©©å®šï¼‰
    "scripts/requirements-minimal.txt",  # å‚™ç”¨æœ€å°åŒ–ä¾è³´
    "scripts/requirements-zeabur.txt",   # å‚™ç”¨å®Œæ•´ä¾è³´
    "scripts/requirements.txt"           # æœ€å¾Œå‚™ç”¨
]

# æ§‹å»ºå‘½ä»¤ï¼ˆå¯é¸ï¼‰
build_command = """
echo "=== Zeabur åŸç”Ÿ Python éƒ¨ç½² ===" &&
echo "ğŸ“‚ ç•¶å‰ç›®éŒ„: $(pwd)" &&
echo "ğŸ Python ç‰ˆæœ¬: $(python --version)" &&
echo "ğŸ“¦ å®‰è£ä¾è³´..." &&
cd scripts &&
echo "âœ… ä¾è³´å®‰è£å®Œæˆ"
"""

[run]
# å•Ÿå‹•å‘½ä»¤
start_command = "python scripts/main.py"

# å·¥ä½œç›®éŒ„
working_directory = "."

# æš´éœ²ç«¯å£
port = 8000

# ç’°å¢ƒè®Šæ•¸
[env]
# Python ç›¸é—œ
PYTHONPATH = "/opt/zeabur/src"
PYTHONUNBUFFERED = "1"
PYTHONDONTWRITEBYTECODE = "1"

# æ‡‰ç”¨ç›¸é—œ
PORT = "8000"
HOST = "0.0.0.0"

# é‹è¡Œæ™‚è¨­ç½®
[runtime]
# å¥åº·æª¢æŸ¥
health_check = "/health"

# å•Ÿå‹•è¶…æ™‚ï¼ˆç§’ï¼‰
start_timeout = 300

# è¨˜æ†¶é«”é™åˆ¶ï¼ˆMBï¼‰
memory_limit = 1024

# CPU é™åˆ¶
cpu_limit = 1.0

# é‡å•Ÿç­–ç•¥
restart_policy = "always"

[services.backend]
# æœå‹™åç¨±
name = "llamaindex-knowledge-base"

# æœå‹™æè¿°
description = "ä¼æ¥­çŸ¥è­˜åº«ç³»çµ± - æ”¯æŒç”¨æˆ¶èªè­‰å’ŒAIæ¨¡å‹ç®¡ç†"

# ç‰ˆæœ¬
version = "2.0.0"

# å€åŸŸåå¥½
regions = ["hkg", "nrt", "sin"]

# è‡ªå‹•æ“´å±•è¨­ç½®
[services.backend.scaling]
min_instances = 1
max_instances = 3
target_cpu = 70

# æ—¥èªŒè¨­ç½®
[logging]
level = "INFO"
format = "json"

# æŒä¹…åŒ–å­˜å„²é…ç½®
[storage]
# ç”¨æˆ¶æ–‡æª”å­˜å„²
user_documents = {
    path = "user_documents",
    type = "persistent",
    size = "5GB"
}

# ç”¨æˆ¶ç´¢å¼•å­˜å„²  
user_indexes = {
    path = "user_indexes", 
    type = "persistent",
    size = "2GB"
}

# æ•¸æ“šåº«å­˜å„²
database = {
    path = "knowledge_base.db",
    type = "persistent", 
    size = "1GB"
}

# æ—¥èªŒå­˜å„²
logs = {
    path = "logs",
    type = "temporary",
    size = "500MB"
}

# é–‹ç™¼æ¨¡å¼è¨­ç½®
[dev]
# é–‹ç™¼æ™‚çš„ç’°å¢ƒè®Šæ•¸
auto_reload = true
debug = true 